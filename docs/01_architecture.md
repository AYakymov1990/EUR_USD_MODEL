# Архитектура (описание)

## Слои
- **Model layer (заморожен)**: `src/features.py`, `src/model.py`, `src/backtest.py`, ноутбуки 02/03. Отвечает за данные/фичи, обучение, бектест, выбор конфига.
- **CRM layer**: `src/crm/` — работа с конфигом, получение свечей/фичей, инференс, объяснение, генерация сигналов/порогов, хранилище событий, интеграция OANDA, расчёт живых метрик, планировщик.
- **UI layer**: `app.py` (Streamlit) — визуализация сигналов/метрик, кнопки подтверждения.

## Поток данных (demo mode)
1. `data_feed` читает свечи/фичи из тестового среза (реплей).
2. `features_adapter` подготавливает входы под модель.
3. `inference` грузит скейлер/модель, выдаёт `y_hat` + метаданные.
4. `signals` применяет thresholds/regime из `selected_config.json`, рассчитывает сигнал и confidence.
5. `explain` строит краткое RU-объяснение по ключевым признакам/предсказанию.
6. `storage` сохраняет сигнал, `metrics_live` обновляет сводки, UI показывает.
7. При нажатии LONG/SHORT записываем действие, в live режиме `oanda_executor` отправляет ордер.

## Поток данных (live mode)
1. `data_feed` тянет свечи с OANDA (безопасно, practice по умолчанию).
2. Далее шаги как в demo mode.
3. `oanda_executor` отправляет/закрывает ордера, пишет ответы в `storage`.

## Артефакты
- `data/artifacts/selected_config.json` — порог/режим/hold_bars/polarity.
- Сохранённые модель/скейлер (ожидаются рядом в `data/artifacts/`).
- SQLite база аудита (`data/artifacts/trader_crm.sqlite`).

## Безопасность
- Ключи/аккаунты только через `.env`/окружение.
- Логи без секретов, сетевые ошибки — с ясным текстом.
- Исполнение в demo mode по умолчанию.
